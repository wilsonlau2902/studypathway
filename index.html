<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wai Ming's Pathway | DDP (CS + Finance)</title>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Annotation Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .course-card { transition: all 0.2s; }
        .course-card:hover { transform: translateY(-2px); }
        select { background-image: none; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: 600; }
        .tab-inactive { color: #64748b; font-weight: 500; }
        
        .badge-offered { background-color: #dcfce7; color: #166534; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: 700; border: 1px solid #bbf7d0; }
        .badge-arch { background-color: #d1fae5; color: #065f46; border: 1px solid #34d399; } /* Architect */
        .badge-spec { background-color: #dbeafe; color: #1e40af; border: 1px solid #60a5fa; } /* Specialist */
        .badge-ana { background-color: #ffedd5; color: #9a3412; border: 1px solid #fb923c; } /* Analyst */
        .badge-comm { background-color: #fee2e2; color: #991b1b; border: 1px solid #f87171; } /* Commodity */
        
        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.9); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.9); transition: opacity 300ms, transform 300ms; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Set worker for PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Register Chart.js plugin
        Chart.register(window['chartjs-plugin-annotation']);

        const { useState, useEffect, useMemo, useRef } = React;

        // --- DATA CONSTANTS ---
        const STATUS = {
            COMPLETED: 'completed',
            IN_PROGRESS: 'in-progress',
            PLANNED: 'planned',
            NOT_STARTED: 'not-started'
        };

        // --- STRATEGY DB (Extended) ---
        const COURSE_ANALYSIS_DB = {
            "COMP 4901Z": { 
                name: "Reinforcement Learning", 
                synergy: 9.5, ai: 9, 
                desc: "Fundamentals of RL, Markov decision processes, value functions, policy gradient methods, deep RL.",
                rationale: "THE ARCHITECT. RL is the 'brain' of modern Algo Trading. AI can write the code, but YOU must design the reward functions and constraints. High math barrier = job security."
            },
            "COMP 4541": { 
                name: "Blockchain & Smart Contracts", 
                synergy: 10, ai: 8.5, 
                desc: "Cryptocurrencies, Bitcoin/Ethereum protocols, smart contract development (Solidity), security vulnerabilities.",
                rationale: "THE ARCHITECT. DeFi is the future of your Finance major. Security auditing of smart contracts is a high-responsibility role AI cannot fully be trusted with yet."
            },
            "COMP 4471": { 
                name: "Deep Learning in Computer Vision", 
                synergy: 8, ai: 7.5, 
                desc: "CNNs, RNNs, end-to-end optimization for high-level (recognition) and low-level (enhancement) vision tasks. Image recognition, image enhancement.",
                rationale: "THE SPECIALIST. Highly relevant for 'Alternative Data' in finance (e.g., analyzing satellite images of retail parking lots to predict earnings). Hard technical skills that go beyond simple text processing."
            },
            "COMP 4651": { 
                name: "Cloud Computing & Big Data", 
                synergy: 8.5, ai: 8.5, 
                desc: "MapReduce, Hadoop, Spark, datacenter-scale programming, distributed file systems.",
                rationale: "THE ARCHITECT. Financial data is massive (tick data). Architecting the distributed systems to handle this at speed (HFT) is a structural engineering role, not just coding."
            },
            "COMP 4634": { 
                name: "Cybersecurity", 
                synergy: 9, ai: 8, 
                desc: "Vulnerabilities in software/hardware/networks, defense strategies, risk analysis, business continuity.",
                rationale: "THE ARCHITECT. Banks are paranoid. Being the person responsible for signing off on security architecture is a role requiring human liability and trust."
            },
            "COMP 3631": { 
                name: "Cryptography", 
                synergy: 7.5, ai: 9.5, 
                desc: "Mathematical foundations, public-key ciphers, digital signatures, authentication protocols.",
                rationale: "THE SPECIALIST. Pure math is timeless. AI struggles to innovate here without hallucinations. Essential for high-end FinTech security."
            },
            "COMP 4211": { 
                name: "Machine Learning", 
                synergy: 9, ai: 6, 
                desc: "Supervised/unsupervised learning, Bayesian learning, neural networks, generalization.",
                rationale: "THE ANALYST. Essential literacy. You must know this to understand the 'Black Box' of trading models, even if AI eventually writes the boilerplate training code."
            },
            "COMP 4331": { 
                name: "Data Mining", 
                synergy: 9, ai: 5, 
                desc: "Data warehousing, preprocessing, association rules, clustering, social networks.",
                rationale: "THE ANALYST. Very useful for Quants, but data cleaning/mining is becoming automated by tools like ChatGPT Code Interpreter. Focus on the theory."
            },
            "COMP 4461": { 
                name: "Human-Computer Interaction", 
                synergy: 4, ai: 3, 
                desc: "This course is a broad introduction to Human-Computer Interaction (HCI), with an emphasis on techniques, models, theories, and applications for designing, prototyping, and evaluating current and future interactive systems for human use. HCI is an interesting and important area of study, providing the human perspective to computing. Besides technology and innovation, it also touches on issues like ethics and social responsibilities related to technologies in the real world.",
                rationale: "THE COMMODITY. UI/UX design is increasingly AI-assisted (v0.dev, etc.). Unless you want to be a Product Manager, this is less 'hard' leverage than backend systems. Good for soft skills but high replacement risk for pure execution."
            },
            "COMP 4521": { 
                name: "Mobile App Development", 
                synergy: 3, ai: 2, 
                desc: "Android/iOS development, UI design, mobile backend support.",
                rationale: "THE COMMODITY. AI is excellent at writing React/Swift boilerplate. This skill is depreciating fast. Learn it on a weekend if needed, don't spend credits."
            },
            "COMP 4901A": { 
                name: "Distributed Systems", 
                synergy: 8, ai: 8.5, 
                desc: "Consistency, fault tolerance, consensus algorithms (Paxos/Raft), distributed storage.",
                rationale: "THE ARCHITECT. Critical for Crypto exchanges and banking ledgers. Debugging distributed race conditions is extremely hard for AI."
            },
            "COMP 3021": { 
                name: "Java Programming", 
                synergy: 2, ai: 2, 
                desc: "Java syntax, OOP, exception handling, standard libraries.",
                rationale: "THE COMMODITY. Syntax is free. AI writes Java faster than you. Focus on concepts (Algorithms), not languages."
            },
            "COMP 4421": { 
                name: "Image Processing", 
                synergy: 6, ai: 7, 
                desc: "Spatial/frequency domains, image restoration, compression, segmentation.",
                rationale: "THE SPECIALIST. Good foundational math (Fourier transforms), useful for specific FinTech niches (KYC identity verification)."
            },
            "COMP 3721": {
                name: "Theory of Computation",
                synergy: 4, ai: 9.5,
                desc: "Automata, Turing machines, undecidability, P vs NP.",
                rationale: "THE SPECIALIST. Pure logic. Zero immediate business value, but trains a mind that AI cannot easily trick. High prestige, low utility."
            },
            "COMP 3311": {
                name: "Database Management Systems",
                synergy: 8, ai: 5,
                desc: "Relational models, SQL, normalization, transaction management.",
                rationale: "THE ANALYST. SQL is essential for Finance, but AI writes SQL perfectly. Take it if you don't know it, but don't expect it to be a differentiator."
            },
             "COMP 4021": {
                name: "Internet Computing",
                synergy: 3, ai: 2,
                desc: "Web technologies, client/server side scripting, security.",
                rationale: "THE COMMODITY. Basic web dev is the first thing AI automated. Avoid unless you want to build simple dashboards."
            }
        };

        // --- CATALOG DATABASES (Restored and Expanded) ---
        const DEFAULT_COMP_DB = {
            "AI / Theory": [
                { code: "COMP 3211", name: "Fundamentals of Artificial Intelligence" },
                { code: "COMP 3721", name: "Theory of Computation" },
                { code: "COMP 4211", name: "Machine Learning" },
                { code: "COMP 4221", name: "Introduction to Natural Language Processing" },
                { code: "COMP 4222", name: "Machine Learning with Structured Data" },
                { code: "COMP 4331", name: "Data Mining" },
                { code: "COMP 4332", name: "Big Data Mining and Management" },
                { code: "COMP 4421", name: "Image Processing" },
                { code: "COMP 4471", name: "Deep Learning in Computer Vision" },
                { code: "COMP 4541", name: "Blockchain, Cryptocurrencies and Smart Contracts" },
                { code: "COMP 4901L", name: "Foundations of Computer Vision" },
                { code: "COMP 4901R", name: "Algorithmic Game Theory" },
                { code: "COMP 4901T", name: "Introduction to Computer Vision" },
                { code: "COMP 4901V", name: "Large-Scale Deep Perception for Autonomous Vehicles" },
                { code: "COMP 4901X", name: "Formal Reasoning about Programs" },
                { code: "COMP 4901Y", name: "Large-Scale Machine Learning for Foundation Models" },
                { code: "COMP 4901Z", name: "Reinforcement Learning" }
            ],
            "Vision & Graphics": [
                { code: "COMP 4411", name: "Computer Graphics" },
                { code: "COMP 4461", name: "Human-Computer Interaction" },
                { code: "COMP 4462", name: "Data Visualization" },
                { code: "COMP 5411", name: "Advanced Computer Graphics" },
                { code: "COMP 5421", name: "Computer Vision" }
            ],
            "Software / Database": [
                { code: "COMP 3021", name: "Java Programming" },
                { code: "COMP 3031", name: "Principles of Programming Languages" },
                { code: "COMP 3311", name: "Database Management Systems" },
                { code: "COMP 4021", name: "Internet Computing" },
                { code: "COMP 4111", name: "Software Engineering Practices" },
                { code: "COMP 4121", name: "Modern Compiler Construction" },
                { code: "COMP 4321", name: "Search Engines for Web and Enterprise Data" },
                { code: "COMP 4651", name: "Cloud Computing and Big Data Systems" },
                { code: "COMP 4901A", name: "Distributed Systems" },
                { code: "COMP 5111", name: "Fundamentals of Software Analysis" },
                { code: "COMP 5112", name: "Parallel Programming" },
                { code: "COMP 5311", name: "Database Architecture and Implementation" }
            ],
            "Systems / Networking": [
                { code: "COMP 3631", name: "Cryptography" },
                { code: "COMP 4511", name: "System and Kernel Programming in Linux" },
                { code: "COMP 4521", name: "Mobile Application Development" },
                { code: "COMP 4531", name: "IoT and Smart Sensing" },
                { code: "COMP 4611", name: "Design and Analysis of Computer Architectures" },
                { code: "COMP 4621", name: "Computer and Communication Networks" },
                { code: "COMP 4632", name: "Practicing Cybersecurity" },
                { code: "COMP 4634", name: "Cybersecurity" },
                { code: "COMP 4635", name: "Practical Cloud Computing Security" },
                { code: "COMP 4641", name: "Social Information Network Analysis" },
                { code: "COMP 4901Q", name: "High Performance Computing" },
                { code: "COMP 5621", name: "Computer Networks" },
                { code: "COMP 5631", name: "Cryptography and Security" }
            ],
            "Other": [
                { code: "COMP 4911", name: "IT Entrepreneurship" }
            ]
        };

        const DEFAULT_FINA_DB = {
            "Corporate Finance": [
                { code: "FINA 4013", name: "Corporate Valuation" },
                { code: "FINA 4203", name: "Mergers, Acquisitions, and Corporate Restructuring" },
                { code: "FINA 4603", name: "Venture Capital Financing" }
            ],
            "Investments": [
                { code: "FINA 4303", name: "Fixed Income Securities" },
                { code: "FINA 4513", name: "Risk Management" }
            ],
            "FinTech": [
                { code: "FINA 4703", name: "ESG Investing" },
                { code: "FINA 4713", name: "Intro to AI and Big Data in Finance" }
            ],
            "Other": []
        };

        // --- CATEGORIES LOGIC ---
        const categoriesStructure = [
             {
                    id: "common_core",
                    title: "University Common Core (30 Credits)",
                    color: "bg-pink-100 text-pink-800",
                    requirements: [
                        { id: "cc_legal", name: "Legal Education", code: "LEGL 1000", status: STATUS.COMPLETED, grade: "P", note: "Foundations I" },
                        { id: "cc_hmw", name: "Habits, Mindsets & Wellness", code: "HMAW 1905B", status: STATUS.COMPLETED, grade: "P", note: "Foundations I (3 credits)" },
                        { id: "cc_ecomm1", name: "English Comm I", code: "LANG 1402", status: STATUS.COMPLETED, grade: "T", note: "Foundations I - E-Comm (3 credits)" },
                        { id: "cc_ecomm2", name: "English Comm II", code: "LANG 1404", status: STATUS.COMPLETED, grade: "A-", note: "Foundations I - E-Comm (3 credits)" },
                        { id: "cc_ccomm", name: "Chinese Comm (C-Comm)", code: "LANG 1113", status: STATUS.NOT_STARTED, note: "Foundations I (3 credits needed)" },
                        { id: "cc_arts", name: "Arts (A) - Broadening", code: "CORE BROAD", status: STATUS.COMPLETED, grade: "T", note: "Transfer Credit (3 credits)" },
                        { id: "cc_huma", name: "Humanities (H) - Broadening", code: "CORE BROAD", status: STATUS.COMPLETED, grade: "T", note: "Transfer Credit (3 credits)" },
                        { id: "cc_sci", name: "Science (S) - Broadening", code: "BIEN 1610", status: STATUS.IN_PROGRESS, note: "Broadening (3 credits)" },
                        { id: "cc_broad_4", name: "Broadening Elective (Any Area)", code: "", status: STATUS.NOT_STARTED, type: "text_input", note: "Required 4th Broadening Course (3 credits)" },
                        { id: "cc_ctdl", name: "Critical Thinking & Data Lit (CTDL)", code: "", status: STATUS.NOT_STARTED, type: "text_input", note: "Foundations II (3 credits needed)" },
                        { id: "cc_exp_upop1", name: "UPOP Pre-internship Training", code: "UPOP 1920", status: STATUS.COMPLETED, grade: "P", note: "Experiencing (1 credit)" },
                        { id: "cc_exp_upop2", name: "UG Practice Opportunities", code: "UPOP 2920", status: STATUS.COMPLETED, grade: "P", note: "Experiencing (2 credits)" }
                    ]
                },
                {
                    id: "eng_fund",
                    title: "Engineering Fundamentals",
                    color: "bg-blue-100 text-blue-800",
                    requirements: [
                        { id: "intro_cs", name: "Intro to CS", alternatives: ["COMP 1021", "COMP 1022P"], status: STATUS.COMPLETED, taken: "COMP 1021", grade: "B" },
                        { id: "calc_1", name: "Calculus I", alternatives: ["MATH 1012", "MATH 1013", "MATH 1023"], status: STATUS.COMPLETED, taken: "MATH 1013", grade: "T" },
                        { id: "calc_2", name: "Calculus II", alternatives: ["MATH 1014", "MATH 1024"], status: STATUS.COMPLETED, taken: "MATH 1014", grade: "C-" },
                        { id: "lin_alg", name: "Linear Algebra", alternatives: ["MATH 2111", "MATH 2121", "MATH 2131"], status: STATUS.COMPLETED, taken: "MATH 2111", grade: "C+" },
                        { id: "sci_fund", name: "Science Fundamental", alternatives: ["CHEM 1008", "CHEM 1012", "CHEM 1020", "LIFS 1901", "PHYS 1101", "PHYS 1112", "PHYS 1312"], status: STATUS.COMPLETED, taken: "PHYS 1101", grade: "A", note: "Take ONE (3-4 credits). Extras count as Free Electives." },
                        { id: "eng_intro", name: "Engg Intro", alternatives: ["CENG 1500", "ELEC 1100", "MECH 1901"], status: STATUS.COMPLETED, taken: "CENG 1500", grade: "A-", note: "SENG Intro Requirement" },
                        { id: "engg_2010", name: "Engg Seminar", code: "ENGG 2010", status: STATUS.IN_PROGRESS, note: "Engineering requirement" },
                        { id: "tech_comm_1", name: "Tech Comm I", alternatives: ["LANG 2030"], status: STATUS.COMPLETED, note: "Waived for DDP or met by LANG 1404 track" },
                    ]
                },
                {
                    id: "cs_core",
                    title: "Computer Science Core",
                    color: "bg-indigo-100 text-indigo-800",
                    requirements: [
                        { id: "comp_2011", name: "Programming with C++", code: "COMP 2011", status: STATUS.COMPLETED, grade: "C-", prereqs: ["COMP 1021"] },
                        { id: "comp_2012", name: "OOP & Data Structures", code: "COMP 2012", status: STATUS.COMPLETED, grade: "C", prereqs: ["COMP 2011"] },
                        { id: "comp_2611", name: "Computer Organization", code: "COMP 2611", status: STATUS.COMPLETED, grade: "B-", prereqs: ["COMP 1021"] },
                        { id: "comp_2711", name: "Discrete Math Tools", code: "COMP 2711", status: STATUS.COMPLETED, grade: "B-", prereqs: ["MATH 1013"] },
                        { id: "comp_3111", name: "Software Engineering", code: "COMP 3111", status: STATUS.NOT_STARTED, prereqs: ["COMP 2012"] },
                        { id: "comp_3511", name: "Operating Systems", code: "COMP 3511", status: STATUS.NOT_STARTED, prereqs: ["COMP 2611"] },
                        { id: "comp_3711", name: "Algorithms", code: "COMP 3711", status: STATUS.IN_PROGRESS, prereqs: ["COMP 2711", "Calculus"] },
                        { id: "comp_4900", name: "Acad. & Prof. Dev.", code: "COMP 4900", status: STATUS.IN_PROGRESS, note: "Must take every term in residency" },
                        { id: "prob_stat", name: "Probability/Stats", alternatives: ["ELEC 2600", "IEDA 2520", "MATH 2411"], status: STATUS.IN_PROGRESS, taken: "IEDA 2520", note: "MATH 2411 recommended for COMP, but IEDA 2520 accepted" },
                        { id: "fyp", name: "Final Year Project", alternatives: ["COMP 4981", "COMP 4981H", "COMP 4910"], status: STATUS.NOT_STARTED, credits: 6, note: "COMP 4910 (Co-op) satisfies this + Ind. Exp." },
                        { id: "ind_exp", name: "Industrial Experience", code: "COMP 1991", status: STATUS.NOT_STARTED, note: "Or COMP 4910" },
                        { id: "lang_4030", name: "Tech Comm II", code: "LANG 4030", status: STATUS.NOT_STARTED, note: "For CSE/CPEG" }
                    ]
                },
                {
                    id: "cs_electives",
                    title: "CS Electives (5 Courses)",
                    color: "bg-purple-100 text-purple-800",
                    description: "3 from one area, 2 from outside. Areas: AI, Vision, Software, Systems.",
                    requirements: [
                        { id: "elec_1", name: "Elective 1", code: "Select Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "COMP" },
                        { id: "elec_2", name: "Elective 2", code: "Select Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "COMP" },
                        { id: "elec_3", name: "Elective 3", code: "Select Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "COMP" },
                        { id: "elec_4", name: "Elective 4", code: "Select Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "COMP" },
                        { id: "elec_5", name: "Elective 5", code: "Select Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "COMP" },
                    ]
                },
                {
                    id: "biz_core",
                    title: "Business Core (Finance)",
                    color: "bg-emerald-100 text-emerald-800",
                    requirements: [
                        { id: "acct_2010", name: "Accounting I", code: "ACCT 2010", status: STATUS.COMPLETED, grade: "B+" },
                        { id: "acct_2200", name: "Accounting II", code: "ACCT 2200", status: STATUS.COMPLETED, grade: "B-" },
                        { id: "econ_2113", name: "Microeconomics", code: "ECON 2113", status: STATUS.COMPLETED, grade: "A" },
                        { id: "econ_2123", name: "Macroeconomics", code: "ECON 2123", status: STATUS.COMPLETED, grade: "B" },
                        { id: "isom_2500", name: "Business Stats", code: "ISOM 2500", status: STATUS.COMPLETED, grade: "B", note: "Or MATH 2411" },
                        { id: "isom_2600", name: "Business Analytics", code: "ISOM 2600", status: STATUS.COMPLETED, grade: "A-" },
                        { id: "isom_2700", name: "Ops Management", code: "ISOM 2700", status: STATUS.COMPLETED, grade: "A-" },
                        { id: "mark_2120", name: "Marketing Mgmt", code: "MARK 2120", status: STATUS.COMPLETED, grade: "A-" },
                        { id: "mgmt_2010", name: "Biz Ethics", code: "MGMT 2010", status: STATUS.COMPLETED, grade: "A" },
                        { id: "mgmt_2110", name: "Org Behavior", code: "MGMT 2110", status: STATUS.COMPLETED, grade: "A+" },
                        { id: "fina_2303", name: "Financial Mgmt", code: "FINA 2303", status: STATUS.COMPLETED, grade: "A" },
                        { id: "bba_comm", name: "BBA Communication (School-Based English)", alternatives: ["LANG 2061", "LANG 2062", "LANG 3060"], status: STATUS.NOT_STARTED, note: "Select one. ECON 3700 is restricted." },
                        { id: "mgmt_2130", name: "Biz Ethics & Soc Resp", code: "MGMT 2130", status: STATUS.IN_PROGRESS },
                    ]
                },
                {
                    id: "fina_major",
                    title: "Finance Major Required",
                    color: "bg-teal-100 text-teal-800",
                    requirements: [
                        { id: "fina_3103", name: "Inter. Investments", code: "FINA 3103", status: STATUS.IN_PROGRESS, prereqs: ["FINA 2303"] },
                        { id: "fina_3203", name: "Derivative Securities", code: "FINA 3203", status: STATUS.NOT_STARTED, prereqs: ["FINA 3103"] },
                        { id: "fina_3303", name: "Inter. Corp Finance", code: "FINA 3303", status: STATUS.NOT_STARTED, prereqs: ["FINA 2303"] },
                        { id: "fina_3001", name: "Key Skills Finance", code: "FINA 3001", status: STATUS.IN_PROGRESS },
                        { id: "fina_3810", name: "Bloomberg Cert", code: "FINA 3810", status: STATUS.IN_PROGRESS },
                        { id: "acct_3030", name: "Intermediate Financial Accounting", alternatives: ["ACCT 3030", "ACCT 3010 + ACCT 3020"], status: STATUS.NOT_STARTED, note: "Required for BBA. ACCT 3030 is standard for Non-ACCT majors" },
                        { id: "isom_prog", name: "Business Programming", alternatives: ["ISOM 3230", "ISOM 3400", "COMP 1022P"], status: STATUS.NOT_STARTED, note: "Required. Since you took COMP 1021, you must take ISOM 3230 or 3400." },
                        { id: "fina_elec_1", name: "Finance Elective 1 (3000+)", code: "Select FINA Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "FINA" },
                        { id: "fina_elec_2", name: "Finance Elective 2 (3000+)", code: "Select FINA Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "FINA" },
                        { id: "fina_elec_3", name: "Finance Elective 3 (3000+)", code: "Select FINA Elective", status: STATUS.NOT_STARTED, type: "dropdown", dbKey: "FINA" },
                    ]
                },
                {
                    id: "ddp_extras",
                    title: "Dual Degree (T&M) Specifics",
                    color: "bg-orange-100 text-orange-800",
                    requirements: [
                        { id: "temg_1010", name: "T&M Prof Activities", code: "TEMG 1010", status: STATUS.IN_PROGRESS },
                        { id: "temg_3950", name: "Case Analysis", code: "TEMG 3950", status: STATUS.COMPLETED, grade: "B+" },
                        { id: "temg_4950", name: "Capstone Project", code: "TEMG 4950", status: STATUS.NOT_STARTED },
                    ]
                },
                {
                    id: "free_electives",
                    title: "Free Electives / Unused Courses",
                    color: "bg-gray-100 text-gray-800",
                    description: "Courses taken that don't fit major requirements but count towards 120 credits.",
                    requirements: [
                        { id: "mgmt_3140", name: "Negotiation", code: "MGMT 3140", status: STATUS.IN_PROGRESS, note: "Free Elective (Not DDP Req)" }
                    ]
                }
        ];

        const initialData = {
            studentName: "LAU, Wai Ming",
            studentId: "21011686",
            offeredCourses: [],
            courseCatalogs: { COMP: DEFAULT_COMP_DB, FINA: DEFAULT_FINA_DB },
            categories: categoriesStructure
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState("tracker");
            const [selectedCourse, setSelectedCourse] = useState(null); // For Modal
            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('my_pathway_data_v18_final');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Ensure categories are updated to structure if loading old data
                    // We don't want to overwrite user status, so we need a more careful merge if real persistence is needed.
                    // For this demo/single-file, re-initializing or simple overwrite is safer to ensure logic updates apply.
                    // Let's rely on transcript re-upload for "refreshing" logic.
                    parsed.categories = categoriesStructure; // Force structure update
                    return parsed;
                }
                return initialData;
            });
            const [isProcessing, setIsProcessing] = useState(false);
            const [report, setReport] = useState(null);
            const chartRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('my_pathway_data_v18_final', JSON.stringify(data));
            }, [data]);

            // --- CHART RENDERING ---
            useEffect(() => {
                if (activeTab === 'strategy' && chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    // Filter courses that have analysis data
                    const chartPoints = Object.entries(COURSE_ANALYSIS_DB).map(([code, meta]) => ({
                        x: meta.ai,
                        y: meta.synergy,
                        label: code
                    }));

                    if (window.myChart) window.myChart.destroy();

                    window.myChart = new Chart(ctx, {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                label: 'Elective Courses',
                                data: chartPoints,
                                backgroundColor: (context) => {
                                    const y = context.raw?.y;
                                    const x = context.raw?.x;
                                    if(y >= 8 && x >= 8) return '#059669'; // Green (Architect)
                                    if(y >= 8 && x < 5) return '#d97706'; // Yellow (Analyst)
                                    if(y < 5 && x >= 8) return '#2563eb'; // Blue (Specialist)
                                    return '#dc2626'; // Red (Commodity)
                                },
                                pointRadius: 8,
                                pointHoverRadius: 12
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            onClick: (e, elements) => {
                                if (elements.length > 0) {
                                    const index = elements[0].index;
                                    const code = chartPoints[index].label;
                                    setSelectedCourse({ code, ...COURSE_ANALYSIS_DB[code] });
                                }
                            },
                            scales: {
                                x: { 
                                    title: { display: true, text: 'AI Resistance (Hard to Automate)', font: {weight: 'bold'} },
                                    min: 0, max: 10,
                                    grid: { color: (ctx) => ctx.tick.value === 5 ? '#374151' : '#e5e7eb', lineWidth: (ctx) => ctx.tick.value === 5 ? 2 : 1 }
                                },
                                y: { 
                                    title: { display: true, text: 'Finance Synergy', font: {weight: 'bold'} },
                                    min: 0, max: 10,
                                    grid: { color: (ctx) => ctx.tick.value === 5 ? '#374151' : '#e5e7eb', lineWidth: (ctx) => ctx.tick.value === 5 ? 2 : 1 }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: (context) => context.raw.label
                                    }
                                },
                                annotation: {
                                    annotations: {
                                        label1: { type: 'label', xValue: 9, yValue: 9.5, content: ['THE ARCHITECT'], color: 'green', font: { weight: 'bold', size: 14 } },
                                        label2: { type: 'label', xValue: 1, yValue: 9.5, content: ['THE ANALYST'], color: 'orange', font: { weight: 'bold', size: 14 } },
                                        label3: { type: 'label', xValue: 9, yValue: 0.5, content: ['THE SPECIALIST'], color: 'blue', font: { weight: 'bold', size: 14 } },
                                        label4: { type: 'label', xValue: 1, yValue: 0.5, content: ['THE COMMODITY'], color: 'red', font: { weight: 'bold', size: 14 } }
                                    }
                                }
                            }
                        }
                    });
                }
            }, [activeTab]);

            // --- TRANSCRIPT PARSER (V15 Logic) ---
            const getTextFromPDF = async (file) => {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let fullText = "";
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    fullText += textContent.items.map(item => item.str).join(" ") + "\n";
                }
                return fullText.replace(/\s+/g, ' '); 
            };

            const parseTranscript = async (file) => {
                setIsProcessing(true);
                try {
                    const text = await getTextFromPDF(file);
                    const courseRegex = /([A-Z]{3,4})\s?(\d{4}[A-Z0-9]?|BROAD)/g;
                    const newData = JSON.parse(JSON.stringify(data));
                    const consumedCourses = new Set();
                    const updates = [];
                    let match;

                    // 1. Fulfill Requirements
                    while ((match = courseRegex.exec(text)) !== null) {
                        const code = `${match[1]} ${match[2]}`;
                        const cleanCode = code.replace(/\s/g, '');
                        const window = text.substring(match.index, match.index + 100);
                        const gradeMatch = window.match(/\s([A-D][\+\-]?|F|T|P|PP|AU)(\s|$)/);
                        
                        if (gradeMatch) {
                            const grade = gradeMatch[1];
                            let status = (grade === 'PP') ? STATUS.IN_PROGRESS : STATUS.COMPLETED;
                            let matchedReq = false;

                            newData.categories.forEach(cat => {
                                if (cat.id === 'free_electives') return;
                                cat.requirements.forEach(req => {
                                    const reqCodeClean = req.code ? req.code.replace(/\s/g, '') : '';
                                    if (reqCodeClean === cleanCode) {
                                        req.status = status; req.grade = grade; matchedReq = true;
                                    } else if (req.alternatives) {
                                        const cleanAlts = req.alternatives.map(a => a.replace(/\s/g, ''));
                                        if (cleanAlts.includes(cleanCode)) {
                                            if (!req.taken || req.taken.replace(/\s/g,'') === cleanCode) {
                                                req.status = status; req.grade = grade; req.taken = code; matchedReq = true;
                                            }
                                        }
                                    }
                                });
                            });
                            if (matchedReq) consumedCourses.add(cleanCode);
                        }
                    }

                    // 2. Free Electives
                    courseRegex.lastIndex = 0; 
                    const freeCat = newData.categories.find(c => c.id === 'free_electives');
                    while ((match = courseRegex.exec(text)) !== null) {
                         const code = `${match[1]} ${match[2]}`;
                         const cleanCode = code.replace(/\s/g, '');
                         const window = text.substring(match.index, match.index + 100);
                         const gradeMatch = window.match(/\s([A-D][\+\-]?|F|T|P|PP|AU)(\s|$)/);
                         if (gradeMatch) {
                             const grade = gradeMatch[1];
                             let status = (grade === 'PP') ? STATUS.IN_PROGRESS : STATUS.COMPLETED;
                             if (!consumedCourses.has(cleanCode) && cleanCode !== 'COREBROAD') {
                                 if (!freeCat.requirements.some(r => r.code.replace(/\s/g, '') === cleanCode)) {
                                     freeCat.requirements.push({
                                         id: `free_${cleanCode}`, name: "Free Elective / Extra", code: code, status: status, grade: grade, note: "Auto-detected"
                                     });
                                     consumedCourses.add(cleanCode); 
                                 }
                             }
                         }
                    }
                    setData(newData);
                    setReport({ title: "Success", logs: ["Transcript processed."] });
                } catch(e) { console.error(e); } finally { setIsProcessing(false); }
            };

            const parseCatalog = async (file) => {
                setIsProcessing(true); setProcessStatus("Updating DB...");
                try {
                    const text = await getTextFromPDF(file);
                    const newData = JSON.parse(JSON.stringify(data));
                    const catalogRegex = /([A-Z]{4})\s+(\d{4}[A-Z]?)\s+(.+?)(?=\s+\d+\s+Credit|\s+Previous|\s+Prerequisite)/g;
                    let match; let count = 0;
                    while ((match = catalogRegex.exec(text)) !== null) {
                        const subject = match[1]; const code = `${subject} ${match[2]}`; const title = match[3].replace(/(\d+ Credit.*)/, '').trim();
                        if (subject === 'COMP' || subject === 'FINA') {
                            const db = newData.courseCatalogs[subject];
                            let exists = false;
                            for (const cat in db) if (db[cat].some(c => c.code === code)) exists = true;
                            if (!exists) {
                                if (!db["New / Uncategorized"]) db["New / Uncategorized"] = [];
                                db["New / Uncategorized"].push({ code, name: title });
                                count++;
                            }
                        }
                    }
                    setData(newData); setReport({ title: "Catalog Update", success: true, logs: [`Added ${count} courses.`] });
                } catch(e) { setReport({ title: "Error", success: false, logs: ["Failed."] }); } finally { setIsProcessing(false); }
            };

            const parseSchedule = async (file) => {
                setIsProcessing(true); setProcessStatus("Analyzing Schedule...");
                try {
                    const text = await getTextFromPDF(file);
                    const newData = JSON.parse(JSON.stringify(data));
                    const scheduleRegex = /([A-Z]{4})\s+(\d{4}[A-Z]?)\s?-\s?([^(]+)/g;
                    const offeredSet = new Set(newData.offeredCourses || []);
                    let match; let count = 0;
                    while ((match = scheduleRegex.exec(text)) !== null) {
                        const code = `${match[1]} ${match[2]}`;
                        if (!offeredSet.has(code)) { offeredSet.add(code); count++; }
                    }
                    newData.offeredCourses = Array.from(offeredSet);
                    setData(newData);
                    setReport({ title: "Schedule Update", success: true, logs: [`Found ${count} new offered courses.`] });
                } catch(e) { setReport({ title: "Error", success: false, logs: ["Failed."] }); } finally { setIsProcessing(false); }
            };

            const handleFile = (e, type) => {
                const file = e.target.files[0];
                if (!file) return;
                if (type === 'transcript') parseTranscript(file);
                else if (type === 'catalog') parseCatalog(file);
                else if (type === 'schedule') parseSchedule(file);
                e.target.value = null; 
            };

            const handleDropdown = (catId, reqId, val) => {
                const newData = { ...data };
                const req = newData.categories.find(c => c.id === catId).requirements.find(r => r.id === reqId);
                req.selectedValue = val; req.code = val; req.status = val ? STATUS.PLANNED : STATUS.NOT_STARTED;
                setData(newData);
            };

            const handleTextChange = (catId, reqId, val) => {
                const newData = { ...data };
                const req = newData.categories.find(c => c.id === catId).requirements.find(r => r.id === reqId);
                req.selectedValue = val; req.code = val;
                setData(newData);
            };

            // --- COMPONENTS ---
            const ElectivesExplorer = () => {
                const [showOfferedOnly, setShowOfferedOnly] = useState(false);
                const [search, setSearch] = useState("");
                const isOffered = (code) => data.offeredCourses && data.offeredCourses.includes(code);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-800">Electives Explorer</h2>
                            <div className="flex gap-4 items-center bg-white p-2 rounded shadow-sm">
                                <label className="flex items-center gap-2 text-sm cursor-pointer select-none">
                                    <input type="checkbox" checked={showOfferedOnly} onChange={(e) => setShowOfferedOnly(e.target.checked)} className="rounded text-indigo-600" />
                                    <span>Show Only Offered</span>
                                </label>
                                <input type="text" placeholder="Search..." className="border rounded px-3 py-1 text-sm" value={search} onChange={e => setSearch(e.target.value)} />
                            </div>
                        </div>
                        <div className="grid md:grid-cols-2 gap-8">
                            {Object.entries(data.courseCatalogs).map(([subject, categories]) => (
                                <div key={subject} className="bg-white rounded-xl shadow p-6">
                                    <h3 className="text-xl font-bold mb-4 border-b pb-2">{subject} Electives</h3>
                                    {Object.entries(categories).map(([category, courses]) => {
                                        const visibleCourses = courses.filter(c => {
                                            const matchesSearch = c.name.toLowerCase().includes(search.toLowerCase()) || c.code.toLowerCase().includes(search.toLowerCase());
                                            const matchesOffer = showOfferedOnly ? isOffered(c.code) : true;
                                            return matchesSearch && matchesOffer;
                                        });
                                        if (visibleCourses.length === 0) return null;
                                        return (
                                            <div key={category} className="mb-6">
                                                <h4 className="font-semibold text-sm text-gray-500 uppercase mb-2">{category}</h4>
                                                <div className="space-y-2">
                                                    {visibleCourses.map(c => (
                                                        <div key={c.code} className="flex justify-between items-center p-2 rounded hover:bg-gray-50">
                                                            <div className="flex items-center gap-2">
                                                                <span className="font-bold text-gray-800 text-sm">{c.code}</span>
                                                                {isOffered(c.code) && <span className="badge-offered">OFFERED</span>}
                                                                <span className="text-sm text-gray-600 truncate max-w-[200px]">{c.name}</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const StrategyTable = () => (
                <div className="mt-8 bg-white rounded-xl shadow overflow-hidden">
                    <div className="px-6 py-4 border-b border-gray-100 bg-gray-50">
                        <h3 className="text-lg font-bold text-gray-800">Detailed Course Analysis</h3>
                        <p className="text-sm text-gray-500">Click any row to see why it fits your goals.</p>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left">
                            <thead className="bg-gray-50 text-gray-600 font-medium border-b">
                                <tr>
                                    <th className="px-6 py-3">Course</th>
                                    <th className="px-6 py-3">Name</th>
                                    <th className="px-6 py-3 text-center">Synergy</th>
                                    <th className="px-6 py-3 text-center">AI Resistance</th>
                                    <th className="px-6 py-3">Quadrant</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {Object.entries(COURSE_ANALYSIS_DB).sort((a,b) => b[1].synergy - a[1].synergy).map(([code, meta]) => (
                                    <tr key={code} 
                                        onClick={() => setSelectedCourse({ code, ...meta })}
                                        className="hover:bg-blue-50 cursor-pointer transition">
                                        <td className="px-6 py-3 font-bold text-gray-800">{code}</td>
                                        <td className="px-6 py-3">{meta.name}</td>
                                        <td className="px-6 py-3 text-center font-mono text-blue-600">{meta.synergy}</td>
                                        <td className="px-6 py-3 text-center font-mono text-green-600">{meta.ai}</td>
                                        <td className="px-6 py-3">
                                            {meta.synergy >= 8 && meta.ai >= 8 ? <span className="badge-arch px-2 py-1 rounded text-xs font-bold">Architect</span> :
                                             meta.synergy >= 8 ? <span className="badge-ana px-2 py-1 rounded text-xs font-bold">Analyst</span> :
                                             meta.ai >= 8 ? <span className="badge-spec px-2 py-1 rounded text-xs font-bold">Specialist</span> :
                                             <span className="badge-comm px-2 py-1 rounded text-xs font-bold">Commodity</span>}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            const CourseModal = ({ course, onClose }) => {
                if (!course) return null;
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={onClose}>
                        <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-6 relative modal-enter-active" onClick={e => e.stopPropagation()}>
                            <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                                <i className="fas fa-times text-xl"></i>
                            </button>
                            <div className="mb-4">
                                <span className={`text-xs font-bold px-2 py-1 rounded uppercase tracking-wide
                                    ${course.synergy >= 8 && course.ai >= 8 ? 'bg-green-100 text-green-800' :
                                      course.synergy >= 8 ? 'bg-yellow-100 text-yellow-800' :
                                      course.ai >= 8 ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800'}`}>
                                    {course.synergy >= 8 && course.ai >= 8 ? 'The Architect' :
                                     course.synergy >= 8 ? 'The Analyst' :
                                     course.ai >= 8 ? 'The Specialist' : 'The Commodity'}
                                </span>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-900 mb-1">{course.code}: {course.name}</h2>
                            <div className="flex gap-4 mb-6 text-sm">
                                <div className="flex items-center text-blue-700 font-bold">
                                    <i className="fas fa-chart-line mr-2"></i> Synergy: {course.synergy}/10
                                </div>
                                <div className="flex items-center text-green-700 font-bold">
                                    <i className="fas fa-robot mr-2"></i> AI Resistance: {course.ai}/10
                                </div>
                            </div>
                            
                            <div className="space-y-4">
                                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 className="text-xs font-bold text-gray-500 uppercase mb-1">Official Description</h4>
                                    <p className="text-sm text-gray-700 leading-relaxed">{course.desc}</p>
                                </div>
                                
                                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <h4 className="text-xs font-bold text-blue-600 uppercase mb-1">Strategic Rationale</h4>
                                    <p className="text-sm text-blue-900 leading-relaxed font-medium">
                                        <i className="fas fa-lightbulb mr-2 text-yellow-500"></i>
                                        {course.rationale}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Main Render
            return (
                <div className="min-h-screen pb-12 bg-gray-50">
                    {/* Header */}
                    <div className="bg-white shadow-sm sticky top-0 z-20">
                        <div className="max-w-6xl mx-auto px-4 py-4">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h1 className="text-xl font-bold text-gray-800">{data.studentName}</h1>
                                    <p className="text-sm text-gray-500">DDP: BEng (COMP) & BBA (FINA)  ID: {data.studentId}</p>
                                </div>
                                <div className="flex gap-2 items-center flex-wrap justify-end">
                                    <label className="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg cursor-pointer flex items-center gap-2 transition shadow-sm">
                                        {isProcessing && processStatus.includes('Transcript') ? <div className="loader"></div> : <i className="fas fa-file-invoice"></i>}
                                        <span className="text-xs font-medium">Transcript</span>
                                        <input type="file" accept=".pdf" className="hidden" onChange={(e) => handleFile(e, 'transcript')} disabled={isProcessing} />
                                    </label>
                                    <label className="bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 rounded-lg cursor-pointer flex items-center gap-2 transition shadow-sm">
                                        <i className="fas fa-book-open"></i> <span className="text-xs font-medium">Catalog</span>
                                        <input type="file" accept=".pdf" className="hidden" onChange={(e) => handleFile(e, 'catalog')} disabled={isProcessing} />
                                    </label>
                                    <label className="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg cursor-pointer flex items-center gap-2 transition shadow-sm">
                                        <i className="fas fa-calendar-alt"></i> <span className="text-xs font-medium">Schedule</span>
                                        <input type="file" accept=".pdf" className="hidden" onChange={(e) => handleFile(e, 'schedule')} disabled={isProcessing} />
                                    </label>
                                </div>
                            </div>
                            <div className="flex gap-8 border-b">
                                <button onClick={() => setActiveTab('tracker')} className={`pb-2 px-1 ${activeTab === 'tracker' ? 'tab-active' : 'tab-inactive'}`}>Pathway Tracker</button>
                                <button onClick={() => setActiveTab('electives')} className={`pb-2 px-1 ${activeTab === 'electives' ? 'tab-active' : 'tab-inactive'}`}>Electives Explorer</button>
                                <button onClick={() => setActiveTab('strategy')} className={`pb-2 px-1 ${activeTab === 'strategy' ? 'tab-active' : 'tab-inactive'}`}>Strategy Matrix</button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 mt-6">
                        {activeTab === 'electives' ? <ElectivesExplorer /> : activeTab === 'strategy' ? (
                            <div>
                                <div className="bg-white p-6 rounded-xl shadow h-[500px]">
                                    <h2 className="text-xl font-bold mb-2 text-gray-800">Elective Landscape</h2>
                                    <div className="h-[420px]">
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>
                                <StrategyTable />
                            </div>
                        ) : (
                            <div className="grid gap-8">
                                {data.categories.map(cat => (
                                    <div key={cat.id} className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                                        <div className={`px-6 py-4 border-b border-gray-100 ${cat.color} bg-opacity-30`}>
                                            <h2 className="text-lg font-bold">{cat.title}</h2>
                                            {cat.description && <p className="text-sm opacity-70">{cat.description}</p>}
                                        </div>
                                        <div className="divide-y divide-gray-50">
                                            {cat.requirements.length === 0 && cat.id === 'free_electives' && (
                                                <div className="p-4 text-sm text-gray-400 italic">No extra courses detected yet. Upload a transcript to populate.</div>
                                            )}
                                            {cat.requirements.map(req => (
                                                <div key={req.id} className="p-4 hover:bg-gray-50 flex justify-between items-center gap-4">
                                                    <div className="flex-1">
                                                        {req.type === 'dropdown' ? (
                                                            <div className="flex items-center gap-2">
                                                                <select className="w-full max-w-md p-2 border rounded text-sm bg-transparent" 
                                                                    value={req.selectedValue || ""} 
                                                                    onChange={(e) => handleDropdown(cat.id, req.id, e.target.value)}>
                                                                    <option value="">-- Select Course --</option>
                                                                    {Object.entries(data.courseCatalogs[req.dbKey]).map(([area, courses]) => (
                                                                        <optgroup key={area} label={area}>
                                                                            {courses.map(c => {
                                                                                const isOffered = data.offeredCourses && data.offeredCourses.includes(c.code);
                                                                                return (
                                                                                    <option key={c.code} value={c.code} className={isOffered ? "font-bold text-green-700" : ""}>
                                                                                        {isOffered ? " " : ""}{c.code} - {c.name}
                                                                                    </option>
                                                                                );
                                                                            })}
                                                                        </optgroup>
                                                                    ))}
                                                                </select>
                                                                {req.selectedValue && data.offeredCourses && data.offeredCourses.includes(req.selectedValue) && (
                                                                    <span className="badge-offered">OFFERED</span>
                                                                )}
                                                            </div>
                                                        ) : req.type === 'text_input' ? (
                                                            <div className="flex flex-col">
                                                                <span className="font-semibold text-gray-800 text-sm">{req.name}</span>
                                                                <input type="text" placeholder="Code" 
                                                                    className="border rounded px-2 py-1 text-xs mt-1 w-48"
                                                                    value={req.selectedValue || ""}
                                                                    onChange={(e) => handleTextChange(cat.id, req.id, e.target.value)} />
                                                                {req.note && <div className="text-xs text-gray-400 mt-1">{req.note}</div>}
                                                            </div>
                                                        ) : (
                                                            <div>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="font-semibold text-gray-800">{req.code || (req.taken || req.alternatives?.[0] || req.name)}</span>
                                                                    {req.grade && <span className="text-xs bg-gray-100 px-2 py-0.5 rounded border">Grade: {req.grade}</span>}
                                                                    {req.status === STATUS.IN_PROGRESS && <span className="text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded border border-yellow-200">In Progress</span>}
                                                                </div>
                                                                <div className="text-xs text-gray-500 mt-1">{req.name !== req.code ? req.name : ''} {req.note && ` ${req.note}`}</div>
                                                                {req.alternatives && !req.taken && <div className="text-xs text-gray-400 mt-1">Options: {req.alternatives.join(", ")}</div>}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center border-2 ${
                                                        req.status === STATUS.COMPLETED ? 'bg-green-500 text-white border-green-600' : 
                                                        req.status === STATUS.IN_PROGRESS ? 'bg-yellow-400 text-white border-yellow-500' : 
                                                        'bg-gray-100 text-gray-300'
                                                    }`}>
                                                        <i className={`fas ${req.status === STATUS.COMPLETED ? 'fa-check' : req.status === STATUS.IN_PROGRESS ? 'fa-spinner' : 'fa-circle'}`}></i>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <CourseModal course={selectedCourse} onClose={() => setSelectedCourse(null)} />
                    
                    <div className="text-center text-gray-400 text-sm mt-12 mb-8">
                        <button onClick={() => { if(confirm("Reset data?")) { localStorage.clear(); window.location.reload(); } }} className="text-red-400 underline">Reset All Data</button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>